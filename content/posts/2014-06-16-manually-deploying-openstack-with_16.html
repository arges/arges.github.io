---
layout: post
title: manually deploying openstack with a virtual maas on ubuntu trusty (part 2)
date: '2014-06-16T10:16:00.001-07:00'
author: arges
tags:
- openstack
- juju
- maas
- ubuntu
modified_time: '2014-06-16T10:16:10.135-07:00'
blogger_id: tag:blogger.com,1999:blog-7705678145617402978.post-3435951131841717408
blogger_orig_url: http://dinosaursareforever.blogspot.com/2014/06/manually-deploying-openstack-with_16.html
---

In the previous post, I went over how to setup a virtual MAAS environment using KVM [<a href="http://dinosaursareforever.blogspot.com/2014/06/manually-deploying-openstack-with.html">1</a>]. Here I will explain how to setup Juju for use with this environment.

<br /><br />For this setup, we’ll use the maas-server as the juju client to interact with the cluster.<br /><br />This guide was very useful:<br /><a href="https://maas.ubuntu.com/docs/juju-quick-start.html">https://maas.ubuntu.com/docs/juju-quick-start.html</a><br /><br />Update to the latest stable tools:<br /><pre class="prettyprint">sudo apt-add-repository ppa:juju/stable<br />sudo apt-get update<br /></pre>Next we want to setup juju on the host machine.<br /><pre class="prettyprint">sudo apt-get install juju-core</pre>Create juju environment file.<br /><pre class="prettyprint">juju init</pre>Generate a specific MAAS API key by using the following link:<br /><a href="http://192.168.100.10/MAAS/account/prefs/">http://192.168.100.10/MAAS/account/prefs/</a><br /><br />write the following to ~/.juju/environments.yaml replacing ‘maas api key’ with what was generated above:<br /><pre class="prettyprint">default: vmaas<br />environments:<br />&nbsp; vmaas:<br />&nbsp; &nbsp; type: maas<br />&nbsp; &nbsp; maas-server: 'http://192.168.100.10/MAAS'<br />&nbsp; &nbsp; maas-oauth: '&lt;maas api key&gt;'<br />&nbsp; &nbsp; admin-secret: ubuntu # or something generated with uuid<br />&nbsp; &nbsp; default-series: trusty<br /></pre>Now let’s sync tools and bootstrap a node. Note, if you have multiple juju environments then you may need to specify ‘-e vmaas’ if it isn’t your default environment.<br /><pre class="prettyprint">juju sync-tools<br />juju bootstrap # add --show-log --debug &nbsp;for more output<br /></pre>See if it works by using the following command:<br /><pre class="prettyprint">juju status</pre>You should see something similar to the following:<br /><pre class="prettyprint">~$ juju status<br />environment: vmaas<br />machines:<br />&nbsp; "0":<br />&nbsp; &nbsp; agent-state: down<br />&nbsp; &nbsp; agent-state-info: (started)<br />&nbsp; &nbsp; agent-version: 1.18.4<br />&nbsp; &nbsp; dns-name: maas-node-0.maas<br />&nbsp; &nbsp; instance-id: /MAAS/api/1.0/nodes/node-e41b0c34-e1cb-11e3-98c6-5254001aae69/<br />&nbsp; &nbsp; series: trusty<br />services: {}<br /></pre>Now we can do a test deployment with the juju-gui to our bootstrap node.<br /><pre class="prettyprint">juju deploy juju-gui</pre>While it is deploying you can type the following to get a log.<br /><pre class="prettyprint">juju debug-log</pre>I wanted to be able to access the juju-gui from an ‘external’ address, so I edited /etc/networking/interfaces on that machine to have a static address:<br /><pre class="prettyprint">juju ssh 0</pre><pre class="prettyprint">sudo vim /etc/networking/interfaces<br /></pre>Add the following to the file:<br /><pre class="prettyprint">auto eth0<br />iface eth0 inet static<br />&nbsp; address 192.168.100.11<br />&nbsp; netmask 255.255.255.0<br /></pre>Bring that interface up.<br /><pre class="prettyprint">sudo ifup eth0</pre>The password can be found here on the host machine:<br /><pre class="prettyprint">grep pass .juju/environments/vmaas.jenv</pre>If you used the above configurations it should be ‘ubuntu’.<br /><br />Log into the service so you can monitor the status graphically during the deployment.<br /><br />If you get errors saying that servers couldn’t be reached you may have DNS configuration or proxy issues. You’ll have to first resolve these before using Juju. I’ve had is intermittent network issues in my lab. In order to workaround those physical issues you may have to retry the bootstrap, or increase the timeout values in ~/.juju/environments.yaml to use the following:<br /><pre class="prettyprint">&nbsp; bootstrap-retry-delay: 5<br />&nbsp; bootstrap-timeout: 1200<br /></pre>Now you’re cooking with juju.<br /><ol><li><a href="http://dinosaursareforever.blogspot.com/2014/06/manually-deploying-openstack-with.html">http://dinosaursareforever.blogspot.com/2014/06/manually-deploying-openstack-with.html</a></li></ol>
