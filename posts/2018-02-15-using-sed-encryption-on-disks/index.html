<!doctype html><html lang><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>using sed encryption on harddrives |</title><link rel=canonical href=/posts/2018-02-15-using-sed-encryption-on-disks/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="using sed encryption on harddrives"><meta property="og:description" content="Disk encryption can be accomplished on Linux in many ways depending on your hardware. LUKS provides block-layer level encryption, and most modern Linux distros provide easy ways to use and setup keys with the device. The eCryptFS project provides filesystem level encryption which gives a bit more flexibility.
However, many new disks have encryption built-in to the drive&rsquo;s controller and can be interfaced with utilities such as hdparm and sedutil-cli. This built in encryption is called FDE (Full Disk Encryption) or SED (Self Encrypting Drives)."><meta property="og:type" content="article"><meta property="og:url" content="/posts/2018-02-15-using-sed-encryption-on-disks/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-02-15T21:42:03-06:00"><meta property="article:modified_time" content="2018-02-15T21:42:03-06:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="using sed encryption on harddrives"><meta name=twitter:description content="Disk encryption can be accomplished on Linux in many ways depending on your hardware. LUKS provides block-layer level encryption, and most modern Linux distros provide easy ways to use and setup keys with the device. The eCryptFS project provides filesystem level encryption which gives a bit more flexibility.
However, many new disks have encryption built-in to the drive&rsquo;s controller and can be interfaced with utilities such as hdparm and sedutil-cli. This built in encryption is called FDE (Full Disk Encryption) or SED (Self Encrypting Drives)."><link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=/posts/2018-01-22-getting-activity-logs-from-azure/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=/posts/2018-10-04-tracing-in-linux/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&text=using%20sed%20encryption%20on%20harddrives" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&title=using%20sed%20encryption%20on%20harddrives" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&is_video=false&description=using%20sed%20encryption%20on%20harddrives" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=using%20sed%20encryption%20on%20harddrives&body=Check out this article: %2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&title=using%20sed%20encryption%20on%20harddrives" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&title=using%20sed%20encryption%20on%20harddrives" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&name=using%20sed%20encryption%20on%20harddrives&description=Disk%20encryption%20can%20be%20accomplished%20on%20Linux%20in%20many%20ways%20depending%20on%20your%20hardware.%20LUKS%20provides%20block-layer%20level%20encryption%2c%20and%20most%20modern%20Linux%20distros%20provide%20easy%20ways%20to%20use%20and%20setup%20keys%20with%20the%20device.%20The%20eCryptFS%20project%20provides%20filesystem%20level%20encryption%20which%20gives%20a%20bit%20more%20flexibility.%0aHowever%2c%20many%20new%20disks%20have%20encryption%20built-in%20to%20the%20drive%26rsquo%3bs%20controller%20and%20can%20be%20interfaced%20with%20utilities%20such%20as%20hdparm%20and%20sedutil-cli.%20This%20built%20in%20encryption%20is%20called%20FDE%20%28Full%20Disk%20Encryption%29%20or%20SED%20%28Self%20Encrypting%20Drives%29." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&t=using%20sed%20encryption%20on%20harddrives" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">using sed encryption on harddrives</h1><div class=meta><div class=postdate><time datetime="2018-02-15 21:42:03 -0600 -0600" itemprop=datePublished>2018-02-15</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/linux rel=tag>linux</a>
,
<a class=tag-link href=/tags/hardware rel=tag>hardware</a></div></div></header><div id=toc><nav id=TableOfContents></nav></div><div class=content itemprop=articleBody><p>Disk encryption can be accomplished on Linux in many ways depending on your
hardware. <a href=https://gitlab.com/cryptsetup/cryptsetup/>LUKS</a> provides block-layer level encryption, and most modern
Linux distros provide easy ways to use and setup keys with the device. The
<a href=http://ecryptfs.org/>eCryptFS</a> project provides filesystem level encryption which gives a bit
more flexibility.</p><p>However, many new disks have encryption built-in to the drive&rsquo;s controller and
can be interfaced with utilities such as <a href=https://wiki.archlinux.org/index.php/hdparm>hdparm</a> and <a href=https://github.com/Drive-Trust-Alliance/sedutil>sedutil-cli</a>.
This built in encryption is called FDE (Full Disk Encryption) or SED (Self
Encrypting Drives). When these disks have encryption keys enabled, upon power
loss they become locked and must be unlocked before they are used. Different
protocols can be used for disks, here I&rsquo;ll cover OPAL and ATA type commands.</p><h1 id=opal-sed-drives>OPAL SED Drives</h1><p>For OPAL drives you can use sedutil-cli to scan for drives:</p><pre tabindex=0><code>sedutil-cli --scan
</code></pre><p>Here you can determine if devices you have are capable. If you have devices
behind a hardware RAID controller you may need to access the device via the
scsi_generic layer via <code>/dev/sgX</code>.</p><p>First you need to initially setup the drive using this command:</p><pre tabindex=0><code>sedutil-cli --initialsetup &lt;password&gt; &lt;device&gt;
</code></pre><p>Once you set the password you can lock the drive:</p><pre tabindex=0><code>sedutil-cli --enableLockingRange 0 &lt;password&gt; &lt;device&gt;
</code></pre><p>At this point if you remove power from the device you will need to unlock it.
To unlock the drive:</p><pre tabindex=0><code>sedutil-cli --setLockingRange 0 rw &lt;password&gt; &lt;device&gt;
</code></pre><p>Or disable drive locking:</p><pre tabindex=0><code>sedutil-cli --disableLockingRange 0 &lt;password&gt; &lt;device&gt;
</code></pre><p>For OPAL drives there are multiple password users: SID and Admin1. Admin1 can
manage locking and SID can manage everything. When you initialize with
&ndash;initialsetup both SID and Admin1 passwords are set to the same thing.</p><p>You can also change the individual passwords using the following:</p><pre tabindex=0><code>sedutil-cli --setSIDPassword &lt;SIDpassword&gt; &lt;newSIDpassword&gt; &lt;device&gt;
sedutil-cli --setAdmin1Pwd &lt;Admin1password&gt; &lt;newAdmin1password&gt; &lt;device&gt;
</code></pre><p>Secure erase can be accomplished using the SID password if you know it:</p><pre tabindex=0><code>seduitl-cli --revertTPer &lt;SIDpassword&gt; &lt;device&gt;
</code></pre><p>If you no longer have the password you&rsquo;ll need to physically look at the drive
and get the PSID. This will be on the sticker on the drive and some even have
QR codes with this information on the drive. To revert with the PSID use:</p><pre tabindex=0><code>sedutil-cli --yesIreallywanttoERASEALLmydatausingthePSID &lt;PSIDALLCAPSNODASHED&gt; &lt;device&gt;
</code></pre><h1 id=ata-sed-drives>ATA SED Drives</h1><p>Some devices such as INTEL, Micron, or Samsung SSDs with SED encryption can
only be driven via an ATA interface and do not implement the OPAL interface.</p><p>To query the device use the standard:</p><pre tabindex=0><code>hdparm -I /dev/sgX
</code></pre><p>Here you&rsquo;ll see a section as follows from the output:</p><pre tabindex=0><code>Security:
	Master password revision code = 65534
		supported
	not	enabled
	not	locked
		frozen
	not	expired: security count
		supported: enhanced erase
	2min for SECURITY ERASE UNIT. 8min for ENHANCED SECURITY ERASE UNIT.
</code></pre><p>If you see <code>supported</code> you can use hdparm to enable locking the drives.
Other fields of note are <code>enabled</code> which indicates if a password is set or not.
The <code>locked</code> field indicates if the drive is locked or unlocked.</p><p>There are two passwords &lsquo;user&rsquo; and &lsquo;master&rsquo; which can have different
capabilities depending on how things are set up. The flag <code>--user-master</code> can
specify &lsquo;u&rsquo; for user or &rsquo;m&rsquo; for master.</p><p>To set a password for the <code>user</code> account:</p><pre tabindex=0><code>hdparm --user-master u --security-set-pass &lt;password&gt; /dev/sgX
</code></pre><p>Locking the drive will happen when you completely remove power from the disk.
To unlock the drive you can use:</p><pre tabindex=0><code>hdparm --user-master u --security-unlock &lt;password&gt; /dev/sgX
</code></pre><p>To disable the password:</p><pre tabindex=0><code>hdparm --user-master u --security-disable &lt;password&gt; /dev/sgX
</code></pre><p>To <a href=https://ata.wiki.kernel.org/index.php/ATA_Secure_Erase>secure erase</a> the drive first ensure drive is not frozen and security is
enabled then run:</p><pre tabindex=0><code>hdparm --user-master u --security-erase &lt;password&gt; /dev/sgX
</code></pre></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&text=using%20sed%20encryption%20on%20harddrives" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&title=using%20sed%20encryption%20on%20harddrives" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&is_video=false&description=using%20sed%20encryption%20on%20harddrives" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=using%20sed%20encryption%20on%20harddrives&body=Check out this article: %2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&title=using%20sed%20encryption%20on%20harddrives" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&title=using%20sed%20encryption%20on%20harddrives" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&name=using%20sed%20encryption%20on%20harddrives&description=Disk%20encryption%20can%20be%20accomplished%20on%20Linux%20in%20many%20ways%20depending%20on%20your%20hardware.%20LUKS%20provides%20block-layer%20level%20encryption%2c%20and%20most%20modern%20Linux%20distros%20provide%20easy%20ways%20to%20use%20and%20setup%20keys%20with%20the%20device.%20The%20eCryptFS%20project%20provides%20filesystem%20level%20encryption%20which%20gives%20a%20bit%20more%20flexibility.%0aHowever%2c%20many%20new%20disks%20have%20encryption%20built-in%20to%20the%20drive%26rsquo%3bs%20controller%20and%20can%20be%20interfaced%20with%20utilities%20such%20as%20hdparm%20and%20sedutil-cli.%20This%20built%20in%20encryption%20is%20called%20FDE%20%28Full%20Disk%20Encryption%29%20or%20SED%20%28Self%20Encrypting%20Drives%29." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2f2018-02-15-using-sed-encryption-on-disks%2f&t=using%20sed%20encryption%20on%20harddrives" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Chris J Arges</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>