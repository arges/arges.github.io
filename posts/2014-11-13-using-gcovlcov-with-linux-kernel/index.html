<!doctype html><html lang><head><link rel=preload href=/chrisarges.net/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/chrisarges.net/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/chrisarges.net/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/chrisarges.net/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>using gcov/lcov with the linux kernel |</title><link rel=canonical href=chrisarges.net/posts/2014-11-13-using-gcovlcov-with-linux-kernel/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="using gcov/lcov with the linux kernel"><meta property="og:description" content="GCOV/LCOV are amazing tools to figure out code coverage in the Linux kernel. It is fairly trivial to setup on your own machine. First, enable the following in your kernel configuration:
CONFIG_GCOV_KERNEL=y CONFIG_GCOV_PROFILE_ALL=y CONFIG_GCOV_FORMAT_AUTODETECT=y Build the kernel and install headers/debug/images to your machine. Note there may be issues if you run this on a separate machine so consult the official documentation for additional information.
Boot the machine with the instrumented kernel and use the following to verify GCOV_KERNEL was setup properly:"><meta property="og:type" content="article"><meta property="og:url" content="chrisarges.net/posts/2014-11-13-using-gcovlcov-with-linux-kernel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-11-13T09:45:00-08:00"><meta property="article:modified_time" content="2014-11-13T09:45:00-08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="using gcov/lcov with the linux kernel"><meta name=twitter:description content="GCOV/LCOV are amazing tools to figure out code coverage in the Linux kernel. It is fairly trivial to setup on your own machine. First, enable the following in your kernel configuration:
CONFIG_GCOV_KERNEL=y CONFIG_GCOV_PROFILE_ALL=y CONFIG_GCOV_FORMAT_AUTODETECT=y Build the kernel and install headers/debug/images to your machine. Note there may be issues if you run this on a separate machine so consult the official documentation for additional information.
Boot the machine with the instrumented kernel and use the following to verify GCOV_KERNEL was setup properly:"><link rel=stylesheet href=/chrisarges.net/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=chrisarges.net/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=chrisarges.net/>Home</a></li><li><a href=chrisarges.net/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=chrisarges.net/posts/2014-10-31-getting-kernel-crashdumps-for-hung/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=chrisarges.net/posts/2015-04-13-qemu-kvm-guest-debugging/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&text=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&title=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&is_video=false&description=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=using%20gcov%2flcov%20with%20the%20linux%20kernel&body=Check out this article: chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&title=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&title=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&name=using%20gcov%2flcov%20with%20the%20linux%20kernel&description=GCOV%2fLCOV%20are%20amazing%20tools%20to%20figure%20out%20code%20coverage%20in%20the%20Linux%20kernel.%20It%20is%20fairly%20trivial%20to%20setup%20on%20your%20own%20machine.%20First%2c%20enable%20the%20following%20in%20your%20kernel%20configuration%3a%0aCONFIG_GCOV_KERNEL%3dy%20CONFIG_GCOV_PROFILE_ALL%3dy%20CONFIG_GCOV_FORMAT_AUTODETECT%3dy%20Build%20the%20kernel%20and%20install%20headers%2fdebug%2fimages%20to%20your%20machine.%20Note%20there%20may%20be%20issues%20if%20you%20run%20this%20on%20a%20separate%20machine%20so%20consult%20the%20official%20documentation%20for%20additional%20information.%0aBoot%20the%20machine%20with%20the%20instrumented%20kernel%20and%20use%20the%20following%20to%20verify%20GCOV_KERNEL%20was%20setup%20properly%3a" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&t=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">using gcov/lcov with the linux kernel</h1><div class=meta><div class=postdate><time datetime="2014-11-13 09:45:00.003 -0800 -0800" itemprop=datePublished>2014-11-13</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/tools rel=tag>tools</a>
,
<a class=tag-link href=/tags/linux rel=tag>linux</a>
,
<a class=tag-link href=/tags/testing rel=tag>testing</a></div></div></header><div id=toc><nav id=TableOfContents></nav></div><div class=content itemprop=articleBody><p>GCOV/LCOV are amazing tools to figure out code coverage in the Linux kernel. It
is fairly trivial to setup on your own machine. First, enable the following in
your kernel configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>CONFIG_GCOV_KERNEL<span style=color:#f92672>=</span>y
</span></span><span style=display:flex><span>CONFIG_GCOV_PROFILE_ALL<span style=color:#f92672>=</span>y
</span></span><span style=display:flex><span>CONFIG_GCOV_FORMAT_AUTODETECT<span style=color:#f92672>=</span>y
</span></span></code></pre></div><p>Build the kernel and install headers/debug/images to your machine. Note there
may be issues if you run this on a separate machine so consult the official
<a href=https://www.kernel.org/doc/Documentation/gcov.txt title="gcov docs">documentation</a> for additional information.</p><p>Boot the machine with the instrumented kernel and use the following to verify
GCOV_KERNEL was setup properly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install lcov gcc
</span></span><span style=display:flex><span>SRC_PATH<span style=color:#f92672>=</span>~/src/linux <span style=color:#75715e># or whatever your path to your kernel tree is</span>
</span></span><span style=display:flex><span>gcov <span style=color:#e6db74>${</span>SRC_PATH<span style=color:#e6db74>}</span>/kernel/sched/core.c -o /sys/kernel/debug/gcov/<span style=color:#e6db74>${</span>SRC_PATH<span style=color:#e6db74>}</span>/kernel/sched/
</span></span></code></pre></div><p>Obviously this would be useful for quick tests, but perhaps we want to test
coverage after a test, and display results graphically. We can reset counters
and use <a href=http://ltp.sourceforge.net/documentation/how-to/UsingCodeCoverage.pdf title="lcov docs">lcov</a> to accomplish this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># reset counters</span>
</span></span><span style=display:flex><span>sudo lcov --zerocounters
</span></span><span style=display:flex><span><span style=color:#75715e># run test</span>
</span></span><span style=display:flex><span>./test.sh
</span></span><span style=display:flex><span><span style=color:#75715e># generate coverage info and generate webpage</span>
</span></span><span style=display:flex><span>sudo lcov -c -o kerneltest.info
</span></span><span style=display:flex><span>sudo genhtml -o /var/www/html kerneltest.info
</span></span></code></pre></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=chrisarges.net/>Home</a></li><li><a href=chrisarges.net/about>About</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&text=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&title=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&is_video=false&description=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=using%20gcov%2flcov%20with%20the%20linux%20kernel&body=Check out this article: chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&title=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&title=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&name=using%20gcov%2flcov%20with%20the%20linux%20kernel&description=GCOV%2fLCOV%20are%20amazing%20tools%20to%20figure%20out%20code%20coverage%20in%20the%20Linux%20kernel.%20It%20is%20fairly%20trivial%20to%20setup%20on%20your%20own%20machine.%20First%2c%20enable%20the%20following%20in%20your%20kernel%20configuration%3a%0aCONFIG_GCOV_KERNEL%3dy%20CONFIG_GCOV_PROFILE_ALL%3dy%20CONFIG_GCOV_FORMAT_AUTODETECT%3dy%20Build%20the%20kernel%20and%20install%20headers%2fdebug%2fimages%20to%20your%20machine.%20Note%20there%20may%20be%20issues%20if%20you%20run%20this%20on%20a%20separate%20machine%20so%20consult%20the%20official%20documentation%20for%20additional%20information.%0aBoot%20the%20machine%20with%20the%20instrumented%20kernel%20and%20use%20the%20following%20to%20verify%20GCOV_KERNEL%20was%20setup%20properly%3a" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=chrisarges.net%2fposts%2f2014-11-13-using-gcovlcov-with-linux-kernel%2f&t=using%20gcov%2flcov%20with%20the%20linux%20kernel" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Chris J Arges</div><div class=footer-right><nav><ul><li><a href=chrisarges.net/>Home</a></li><li><a href=chrisarges.net/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/chrisarges.net/js/code-copy.js></script></html>